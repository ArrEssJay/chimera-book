% ==============================================================================
% The Chimera Project - Preamble
% ==============================================================================
% This file contains all package imports and custom environment definitions
% for the Chimera book.

% ==============================================================================
% PACKAGE IMPORTS
% ==============================================================================

% Font and encoding
\usepackage{fontspec}
\usepackage{xunicode}
\usepackage{xltxtra}

% Mathematics
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{mathtools}

% Graphics and figures
\usepackage{graphicx}
\usepackage{tikz}
\usetikzlibrary{arrows,shapes,positioning,calc,patterns,decorations.pathreplacing}
\usepackage{pgfplots}
\pgfplotsset{compat=1.18}

% Tables
\usepackage{booktabs}
\usepackage{array}
\usepackage{multirow}
\usepackage{longtable}

% Colors
\usepackage[dvipsnames,svgnames,x11names]{xcolor}

% Page layout and formatting
\usepackage[
    paperwidth=7in,
    paperheight=10in,
    top=0.75in,
    bottom=0.75in,
    inner=0.75in,
    outer=0.5in,
    headsep=0.2in,
    footskip=0.3in
]{geometry}

\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{parskip}
\usepackage{microtype}
\usepackage{setspace}

% Lists and enumerations
\usepackage{enumitem}

% Hyperlinks and cross-references
\usepackage{url}
\usepackage[unicode=true,pdfencoding=auto]{hyperref}
\usepackage{cleveref}
\usepackage{bookmark}

% Bibliography
\usepackage[
    backend=biber,
    style=numeric,
    sorting=none,
    maxbibnames=99
]{biblatex}
\addbibresource{bibliography.bib}

% Code listings
\usepackage{listings}
\usepackage{minted}

% Custom boxes and environments
\usepackage{tcolorbox}
\tcbuselibrary{skins,breakable,hooks}
\usepackage{fontawesome5}

% PDF inclusion
\usepackage{pdfpages}

% Units and quantities
\usepackage{siunitx}

% Miscellaneous
\usepackage{xspace}
\usepackage{textcomp}
\usepackage{gensymb}

% ==============================================================================
% PRINT VERSION TOGGLE
% ==============================================================================
\newif\ifprintversion
\printversionfalse  % Set to \printversiontrue for grayscale print version

% ==============================================================================
% COLOR DEFINITIONS
% ==============================================================================
\ifprintversion
    % Grayscale colors for print version
    \definecolor{primaryblue}{RGB}{80,80,80}
    \definecolor{primaryred}{RGB}{60,60,60}
    \definecolor{primaryteal}{RGB}{100,100,100}
    \definecolor{lightblue}{RGB}{240,240,240}
    \definecolor{lightred}{RGB}{235,235,235}
    \definecolor{lightteal}{RGB}{245,245,245}
    % Diagram colors (grayscale)
    \definecolor{diagramlight}{RGB}{220,220,220}
    \definecolor{diagramdark}{RGB}{100,100,100}
    \definecolor{diagramgray}{RGB}{180,180,180}
    \definecolor{diagramprimary}{RGB}{80,80,80}
\else
    % Full color for digital version
    \definecolor{primaryblue}{RGB}{0,82,155}      % Rich blue
    \definecolor{primaryred}{RGB}{179,27,27}      % Dark red
    \definecolor{primaryteal}{RGB}{0,128,128}     % Teal
    \definecolor{lightblue}{RGB}{230,242,255}     % Light blue background
    \definecolor{lightred}{RGB}{255,235,235}      % Light red background
    \definecolor{lightteal}{RGB}{230,255,255}     % Light teal background
    % Diagram colors (full color)
    \definecolor{diagramlight}{RGB}{230,240,250}  % Light blue for diagrams
    \definecolor{diagramdark}{RGB}{0,82,155}      % Dark blue for diagrams
    \definecolor{diagramgray}{RGB}{150,150,150}   % Gray for diagrams
    \definecolor{diagramprimary}{RGB}{0,82,155}   % Primary color for diagrams
\fi

% ==============================================================================
% HYPERREF CONFIGURATION
% ==============================================================================
\hypersetup{
    colorlinks=true,
    linkcolor=primaryblue,
    citecolor=primaryteal,
    urlcolor=primaryblue,
    bookmarksnumbered=true,
    pdfborder={0 0 0}
}

% ==============================================================================
% CUSTOM COMMANDS
% ==============================================================================

% Key terms
\newcommand{\keyterm}[1]{\textbf{#1}\index{#1}}

% Paragraph headings
\newcommand{\parhead}[1]{\par\noindent\textbf{#1}\par\noindent}

% Step counter for worked examples
\newcounter{step}
\newcommand{\step}{\stepcounter{step}\textbf{Step \thestep:} }

% Font commands (placeholders for custom fonts that may not be available)
\providecommand{\trajantitle}{}
\providecommand{\lorettadisplay}{}

% Logged input (for debugging chapter loading)
\newcommand{\loggedinput}[1]{%
    \typeout{LOADING CHAPTER: #1}%
    \input{#1}%
    \typeout{CHAPTER COMPLETE: #1}%
}

% ==============================================================================
% CUSTOM ENVIRONMENTS
% ==============================================================================

% Non-technical summary box (blue, guidance style)
\newtcolorbox{nontechnical}{
    enhanced,
    breakable,
    colback=lightblue,
    colframe=primaryblue,
    boxrule=1pt,
    arc=0mm,
    left=8pt,
    right=8pt,
    top=8pt,
    bottom=8pt,
    before skip=10pt plus 2pt,
    after skip=10pt plus 2pt,
    attach boxed title to top left={yshift=-2mm,xshift=5mm},
    boxed title style={
        colback=primaryblue,
        colframe=primaryblue,
        arc=0mm,
        boxrule=0pt
    },
    title={\textcolor{white}{\faIcon{book-reader} \textbf{Non-Technical Summary}}},
    fonttitle=\sffamily\bfseries
}

% Key concept box (blue, guidance style)
\newtcolorbox{keyconcept}{
    enhanced,
    breakable,
    colback=lightblue,
    colframe=primaryblue,
    boxrule=1pt,
    arc=0mm,
    left=8pt,
    right=8pt,
    top=8pt,
    bottom=8pt,
    before skip=10pt plus 2pt,
    after skip=10pt plus 2pt,
    attach boxed title to top left={yshift=-2mm,xshift=5mm},
    boxed title style={
        colback=primaryblue,
        colframe=primaryblue,
        arc=0mm,
        boxrule=0pt
    },
    title={\textcolor{white}{\faIcon{key} \textbf{Key Concept}}},
    fonttitle=\sffamily\bfseries
}

% Important box (blue, guidance style)
\newtcolorbox{importantbox}{
    enhanced,
    breakable,
    colback=lightblue,
    colframe=primaryblue,
    boxrule=1pt,
    arc=0mm,
    left=8pt,
    right=8pt,
    top=8pt,
    bottom=8pt,
    before skip=10pt plus 2pt,
    after skip=10pt plus 2pt,
    attach boxed title to top left={yshift=-2mm,xshift=5mm},
    boxed title style={
        colback=primaryblue,
        colframe=primaryblue,
        arc=0mm,
        boxrule=0pt
    },
    title={\textcolor{white}{\faIcon{exclamation-circle} \textbf{Important}}},
    fonttitle=\sffamily\bfseries
}

% Warning box (red, alert style)
\newtcolorbox{warningbox}{
    enhanced,
    breakable,
    colback=lightred,
    colframe=primaryred,
    boxrule=1pt,
    arc=0mm,
    left=8pt,
    right=8pt,
    top=8pt,
    bottom=8pt,
    before skip=10pt plus 2pt,
    after skip=10pt plus 2pt,
    attach boxed title to top left={yshift=-2mm,xshift=5mm},
    boxed title style={
        colback=primaryred,
        colframe=primaryred,
        arc=0mm,
        boxrule=0pt
    },
    title={\textcolor{white}{\faIcon{exclamation-triangle} \textbf{Warning}}},
    fonttitle=\sffamily\bfseries
}

% Callout box with custom title (blue, guidance style)
\newtcolorbox{calloutbox}[1][]{
    enhanced,
    breakable,
    colback=lightblue,
    colframe=primaryblue,
    boxrule=1pt,
    arc=0mm,
    left=8pt,
    right=8pt,
    top=8pt,
    bottom=8pt,
    before skip=10pt plus 2pt,
    after skip=10pt plus 2pt,
    attach boxed title to top left={yshift=-2mm,xshift=5mm},
    boxed title style={
        colback=primaryblue,
        colframe=primaryblue,
        arc=0mm,
        boxrule=0pt
    },
    title={\textcolor{white}{\faIcon{info-circle} \textbf{#1}}},
    fonttitle=\sffamily\bfseries
}

% Worked example box (teal, application style)
\newtcolorbox{workedexample}{
    enhanced,
    breakable,
    colback=lightteal,
    colframe=primaryteal,
    boxrule=1pt,
    arc=0mm,
    left=8pt,
    right=8pt,
    top=8pt,
    bottom=8pt,
    before skip=10pt plus 2pt,
    after skip=10pt plus 2pt,
    attach boxed title to top left={yshift=-2mm,xshift=5mm},
    boxed title style={
        colback=primaryteal,
        colframe=primaryteal,
        arc=0mm,
        boxrule=0pt
    },
    title={\textcolor{white}{\faIcon{calculator} \textbf{Worked Example}}},
    fonttitle=\sffamily\bfseries
}

% ==============================================================================
% CHAPTER AND SECTION FORMATTING
% ==============================================================================

% Chapter formatting
\titleformat{\chapter}[display]
    {\normalfont\huge\bfseries\color{primaryblue}}
    {\chaptertitlename\ \thechapter}
    {20pt}
    {\Huge}

% Section formatting
\titleformat{\section}
    {\normalfont\Large\bfseries\color{primaryblue}}
    {\thesection}
    {1em}
    {}

% Subsection formatting
\titleformat{\subsection}
    {\normalfont\large\bfseries\color{primaryblue}}
    {\thesubsection}
    {1em}
    {}

% ==============================================================================
% HEADER AND FOOTER FORMATTING
% ==============================================================================

\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[RE]{\textit{\nouppercase{\leftmark}}}
\fancyhead[LO]{\textit{\nouppercase{\rightmark}}}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}

% Plain style for chapter pages
\fancypagestyle{plain}{
    \fancyhf{}
    \fancyfoot[C]{\thepage}
    \renewcommand{\headrulewidth}{0pt}
}

% ==============================================================================
% CLEVEREF CONFIGURATION
% ==============================================================================

\crefname{chapter}{Chapter}{Chapters}
\Crefname{chapter}{Chapter}{Chapters}
\crefname{section}{Section}{Sections}
\Crefname{section}{Section}{Sections}
\crefname{subsection}{Subsection}{Subsections}
\Crefname{subsection}{Subsection}{Subsections}
\crefname{equation}{Equation}{Equations}
\Crefname{equation}{Equation}{Equations}
\crefname{figure}{Figure}{Figures}
\Crefname{figure}{Figure}{Figures}
\crefname{table}{Table}{Tables}
\Crefname{table}{Table}{Tables}

% ==============================================================================
% END OF PREAMBLE
% ==============================================================================
